---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
############################################################ (a) ############################################################
#############################################################################################################################
#Download Data and adjust it
SP <- read.csv("./^GSPC.csv")
AA <- read.csv("./AAPL.csv")
FF <- read.csv("./FAMAFRENCH.csv")
FF$Mkt.RF <- FF$Mkt.RF/100
FF$SMB <- FF$SMB/100
FF$HML <- FF$HML/100
FF$RF <- FF$RF/100
Price <- SP[,c(1,6)]
names(Price)[2]<-paste("Adj.CloseGSPC")
Price$Adj.CloseAAPL <- AA$Adj.Close
l<-length(Price$Adj.CloseAAPL)
n<-l-1
#Compute returns and excess returns
R_AA <- c()
R_SP <- c()
for(i in 1:n){
  R_AA <- c(R_AA,(Price[i+1,3]-Price[i,3])/Price[i,3])
  R_SP <- c(R_SP,(Price[i+1,2]-Price[i,2])/Price[i,2])
}
Ex_R_AA <- c()
Ex_R_SP <- c()
for(i in 1:n){
  Ex_R_AA[i] <- c(R_AA[i]-FF$RF[i])
  Ex_R_SP[i] <- c(R_SP[i]-FF$RF[i])
}

############################################################ (b) ############################################################
#############################################################################################################################
# Matrix of Y and X
Y<-cbind(Ex_R_AA)
colnames(Y) <- c("")
X<-cbind(replicate(n,1),Ex_R_SP,FF$SMB[1:(n)],FF$HML[1:(n)])
colnames(X) <- c("Intercept","Market Excess Return","SMB","HML")
# Beta estimation
BetaHat=solve(t(X)%*%X)%*%t(X)%*%Y

message("Question b")
message("Estimated parameters")
BetaHat

############################################################ (c) ############################################################
#############################################################################################################################
# Find the estimated errors
M<-diag(n)-X%*%solve(t(X)%*%X)%*%t(X)
E<-M%*%Y
EE<-t(E)%*%E

# number of regressors
k<-ncol(X)
# estimated asymptotical covariance matrix
covB <-EE[1]/(n-k)*solve(t(X)%*%X)
# estimated standard errors
sdB <- cbind(sqrt(diag(covB)))

#compute the quantile
alpha=0.05
t=qt(1-alpha/2,n-k)

#compute the confidence interval
Interval=matrix(0L,k,2)
for (k in 1:k){
  Interval[k,1]= BetaHat[k,1]-t*sdB[k]
  Interval[k,2]= BetaHat[k,1]+t*sdB[k]
}
rownames(Interval) <- c("Intercept","Market Excess Return","SMB","HML")
message("Question c")
message("Standard Errors of parameters")
sdB
message("Interval of confidence")
Interval

############################################################ (d) ############################################################
#############################################################################################################################
plot(E)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

